<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Dashboard Personalizzato - Live Data 2026</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            height: 100vh; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: white;
            overflow: hidden;
        }
        
        .header {
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            font-size: 28px;
            font-weight: 600;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .container {
            display: flex;
            height: calc(100vh - 90px);
        }
        
        .sidebar {
            width: 280px;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(15px);
            padding: 30px 20px;
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        
        .btn {
            width: 100%;
            padding: 18px;
            margin: 12px 0;
            background: rgba(255,255,255,0.15);
            border: none;
            color: white;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn.active, .btn:hover {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }
        
        .main {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            background: rgba(255,255,255,0.03);
        }
        
        .card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(20px);
            padding: 30px;
            margin: 25px 0;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .status-loading {
            color: #ffd700;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .chat {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 420px;
            height: 500px;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(25px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        
        #chatMessages {
            height: 380px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 10px;
        }
        
        .message {
            margin: 12px 0;
            padding: 15px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
        }
        
        .user {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            margin-left: auto;
        }
        
        .ai {
            background: rgba(255,255,255,0.15);
            border-left: 4px solid #4facfe;
        }
        
        input[type="text"], select {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 15px;
            background: rgba(255,255,255,0.15);
            color: white;
            font-size: 16px;
            backdrop-filter: blur(10px);
            margin: 10px 0;
        }
        
        input::placeholder, select::placeholder {
            color: rgba(255,255,255,0.6);
        }
        
        .meteo-main {
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .meteo-icon {
            font-size: 80px;
        }
        
        .meteo-temp {
            font-size: 64px;
            font-weight: bold;
            background: linear-gradient(45deg, #fff, #4facfe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .forecast-day {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }
        
        .city-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .terremoto-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .terremoto-item:last-child {
            border-bottom: none;
        }
        
        .crypto-change.up {
            color: #4ade80;
        }
        
        .crypto-change.down {
            color: #f87171;
        }
        
        @media (max-width: 768px) {
            .sidebar { width: 200px; }
            .chat { width: 90vw; right: 5vw; }
            .meteo-main { flex-direction: column; text-align: center; }
            .city-selector { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="header">
        üåç AI Dashboard Personalizzato - Live Data (15/01/2026)
    </div>
    
    <div class="container">
        <div class="sidebar">
            <button class="btn active" onclick="showPanel('meteo')">üå¶Ô∏è Meteo Personalizzato</button>
            <button class="btn" onclick="showPanel('sismico')">üåç Sismico</button>
            <button class="btn" onclick="showPanel('crypto')">‚Çø Crypto</button>
            <button class="btn" onclick="showPanel('ai')">ü§ñ AI Chat GPT</button>
        </div>
        
        <div class="main">
            <!-- METEO -->
            <div id="meteo" class="panel">
                <div class="card">
                    <div class="city-selector">
                        <select id="citySelect" onchange="updateCityCoords()">
                            <option value="42.305863,14.182742">üè° Bucchianico (Default)</option>
                            <option value="41.9028,12.4964">üèõÔ∏è Roma</option>
                            <option value="45.4642,9.1900">üèôÔ∏è Milano</option>
                            <option value="40.8518,14.2681">üèñÔ∏è Napoli</option>
                            <option value="43.7696,11.2558">üóº Firenze</option>
                            <option value="45.0627,7.6864">üèîÔ∏è Torino</option>
                        </select>
                        <button class="btn" onclick="geolocateMe()" style="padding:15px 20px; font-size:14px;">üìç La Mia Posizione</button>
                    </div>
                    <h2 id="meteoTitle">üå°Ô∏è Meteo Live Bucchianico</h2>
                    <div id="meteoData" class="meteo-main">
                        <div class="status-loading">‚è≥ Caricamento Open-Meteo...</div>
                    </div>
                </div>
                <div class="card">
                    <h3>Previsioni 7 Giorni</h3>
                    <div id="forecast" class="forecast-grid">Seleziona citt√†...</div>
                </div>
            </div>
            
            <!-- SISMICO -->
            <div id="sismico" class="panel" style="display:none;">
                <div class="card">
                    <h2>üåç Terremoti Italia (INGV)</h2>
                    <div id="terremoti">
                        <p class="status-loading">‚è≥ Monitoraggio INGV attivo...</p>
                    </div>
                </div>
            </div>
            
            <!-- CRYPTO -->
            <div id="crypto" class="panel" style="display:none;">
                <div class="card">
                    <h2>‚Çø Crypto Principali (EUR)</h2>
                    <div id="cryptoData">
                        <p class="status-loading">‚è≥ Caricamento CoinGecko...</p>
                    </div>
                </div>
            </div>
            
            <!-- AI -->
            <div id="ai" class="panel" style="display:none;">
                <div class="card">
                    <h2>ü§ñ Chat GPT-4o-mini ‚úÖ ATTIVA</h2>
                    <p><strong>API Key inserita con successo!</strong> Chiedi qualsiasi cosa:</p>
                    <ul style="opacity: 0.9; font-size: 14px;">
                        <li>"Meteo Roma domani"</li>
                        <li>"Analizza Bitcoin oggi"</li>
                        <li>"Terremoti Abruzzo news"</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- CHAT FISSA GPT -->
    <div class="chat">
        <div id="chatMessages">
            <div class="message ai">üöÄ Dashboard con <strong>GPT AI attiva</strong> + Meteo personalizzabile! Prova la chat o cambia citt√†.[web:9][web:13]</div>
        </div>
        <input type="text" id="chatInput" placeholder="Chiedi all'AI: meteo Roma, Bitcoin news..." onkeypress="handleChat(event)">
    </div>

    <script>
        // üåç COORDINATE GLOBALI (personalizzabili)
        let CURRENT_LAT = 42.305863;  // Bucchianico
        let CURRENT_LON = 14.182742;
        
        // ‚úÖ OPENAI API KEY INSERITA (LA TUA!)
        const OPENAI_API_KEY = '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';
        
        // NAVIGAZIONE
        function showPanel(panel) {
            document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
            document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
            document.getElementById(panel).style.display = 'block';
            event.target.classList.add('active');
            
            if(panel === 'meteo') updateMeteo();
            if(panel === 'sismico') updateSismico();
            if(panel === 'crypto') updateCrypto();
        }
        
        // üåÜ METEO PERSONALIZZABILE
        function updateCityCoords() {
            const select = document.getElementById('citySelect');
            const [lat, lon] = select.value.split(',');
            CURRENT_LAT = parseFloat(lat);
            CURRENT_LON = parseFloat(lon);
            updateMeteoTitle();
            updateMeteo();
        }
        
        function updateMeteoTitle() {
            const cities = {
                '42.305863,14.182742': 'Bucchianico',
                '41.9028,12.4964': 'Roma',
                '45.4642,9.1900': 'Milano',
                '40.8518,14.2681': 'Napoli',
                '43.7696,11.2558': 'Firenze',
                '45.0627,7.6864': 'Torino'
            };
            const city = cities[document.getElementById('citySelect').value] || 'Personalizzata';
            document.getElementById('meteoTitle').textContent = `üå°Ô∏è Meteo Live ${city}`;
        }
        
        // üìç GEOLOCALIZZAZIONE
        function geolocateMe() {
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    CURRENT_LAT = pos.coords.latitude;
                    CURRENT_LON = pos.coords.longitude;
                    document.getElementById('citySelect').value = `${CURRENT_LAT},${CURRENT_LON}`;
                    updateMeteoTitle();
                    updateMeteo();
                }, () => alert('Geolocalizzazione non disponibile'));
            }
        }
        
        // METEO API
        async function updateMeteo() {
            try {
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${CURRENT_LAT}&longitude=${CURRENT_LON}&hourly=temperature_2m,relative_humidity_2m,precipitation,weather_code&daily=temperature_2m_max,temperature_2m_min,weather_code&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m&timezone=Europe%2FRome`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                const current = data.current;
                const temp = Math.round(current.temperature_2m);
                const icon = getWeatherIcon(current.weather_code);
                
                document.getElementById('meteoData').innerHTML = `
                    <div class="meteo-icon">${icon}</div>
                    <div class="meteo-temp">${temp}¬∞C</div>
                    <p>${getWeatherDesc(current.weather_code)} | Umidit√†: ${current.relative_humidity_2m}% | Vento: ${Math.round(current.wind_speed_10m)} km/h</p>
                    <p>Aggiornato: ${new Date().toLocaleString('it-IT')}</p>
                `;
                
                let forecastHtml = '';
                for(let i = 1; i < 7; i++) {
                    const day = data.daily.time[i];
                    const maxT = Math.round(data.daily.temperature_2m_max[i]);
                    const minT = Math.round(data.daily.temperature_2m_min[i]);
                    const code = data.daily.weather_code[i];
                    const date = new Date(day);
                    const dayName = date.toLocaleDateString('it-IT', {weekday: 'short'});
                    forecastHtml += `
                        <div class="forecast-day">
                            <div style="font-size: 32px;">${getWeatherIcon(code)}</div>
                            <div>${dayName}</div>
                            <div>${maxT}¬∞ / ${minT}¬∞</div>
                        </div>
                    `;
                }
                document.getElementById('forecast').innerHTML = forecastHtml;
                
            } catch (error) {
                document.getElementById('meteoData').innerHTML = '<p style="color: #f87171;">Errore meteo. Riprova.</p>';
            }
        }
        
        function getWeatherIcon(code) {
            const icons = {0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚õÖ', 3: '‚òÅÔ∏è', 45: 'üå´Ô∏è', 48: 'üå´Ô∏è', 51: 'üå¶Ô∏è', 53: 'üå¶Ô∏è', 55: 'üåßÔ∏è', 61: 'üåßÔ∏è', 63: 'üåßÔ∏è', 65: '‚õàÔ∏è', 71: 'üå®Ô∏è', 73: 'üå®Ô∏è', 75: '‚ùÑÔ∏è', 80: 'üå¶Ô∏è', 95: '‚õàÔ∏è'};
            return icons[code] || 'üå§Ô∏è';
        }
        
        function getWeatherDesc(code) {
            const desc = {0: 'Sereno', 1: 'Parz. nuvoloso', 2: 'Nuvoloso', 3: 'Coperto', 45: 'Nebbia', 51: 'Pioiggia leggera', 61: 'Pioiggia', 63: 'Pioggia moderata'};
            return desc[code] || 'Condizioni meteo';
        }
        
        // SISMICO e CRYPTO (invariati)
        async function updateSismico() {
            try {
                const url = 'https://terremoti.ingv.it/rss';
                const response = await fetch(url);
                const text = await response.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(text, 'text/xml');
                const items = xml.querySelectorAll('item');
                
                let html = `<p>‚úÖ Ultimi terremoti Italia (M>2.0)</p>`;
                if(items.length === 0) {
                    html += '<p>Nessun evento recente.</p>';
                } else {
                    Array.from(items).slice(0, 5).forEach(item => {
                        const title = item.querySelector('title').textContent;
                        const pubDate = item.querySelector('pubDate').textContent;
                        html += `<div class="terremoto-item">
                            <span style="font-weight: 500;">${title}</span>
                            <span style="opacity: 0.7; font-size: 14px;">${new Date(pubDate).toLocaleString('it-IT')}</span>
                        </div>`;
                    });
                }
                document.getElementById('terremoti').innerHTML = html;
            } catch (error) {
                document.getElementById('terremoti').innerHTML = '<p style="color: #f87171;">Errore sismico.</p>';
            }
        }
        
        async function updateCrypto() {
            try {
                const url = 'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=eur&include_24hr_change=true';
                const response = await fetch(url);
                const data = await response.json();
                
                let html = '';
                ['bitcoin', 'ethereum'].forEach(coin => {
                    const price = data[coin].eur.toLocaleString('it-IT', {minimumFractionDigits: 2});
                    const change = data[coin].eur_24h_change.toFixed(2);
                    const changeClass = change >= 0 ? 'up' : 'down';
                    const symbol = coin === 'bitcoin' ? '‚Çø' : 'Œû';
                    html += `
                        <div style="font-size: 28px; margin: 20px 0;">${symbol} ${price} ‚Ç¨</div>
                        <p class="crypto-change ${changeClass}"> ${change >= 0 ? '+' : ''}${change}% (24h)</p>
                        <hr style="margin: 20px 0;">
                    `;
                });
                document.getElementById('cryptoData').innerHTML = html;
            } catch (error) {
                document.getElementById('cryptoData').innerHTML = '<p style="color: #f87171;">Errore crypto.</p>';
            }
        }
        
        // ü§ñ CHAT GPT-4o-mini ATTIVA ‚úÖ
        async function handleChat(event) {
            if(event.key !== 'Enter') return;
            const input = document.getElementById('chatInput');
            const msg = input.value.trim();
            if(!msg) return;
            
            const chat = document.getElementById('chatMessages');
            chat.innerHTML += `<div class="message user">${msg}</div>`;
            input.value = '';
            chat.scrollTop = chat.scrollHeight;
            
            const aiDiv = document.createElement('div');
            aiDiv.className = 'message ai';
            aiDiv.textContent = '‚è≥ GPT AI risponde...';
            chat.appendChild(aiDiv);
            chat.scrollTop = chat.scrollHeight;
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENAI_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'Sei un assistente AI per dashboard meteo/sismico/crypto. Rispondi in italiano, breve, preciso. Oggi √® 15 gennaio 2026. Usa emoji. Conosci Bucchianico Abruzzo.'
                            },
                            { role: 'user', content: msg }
                        ],
                        max_tokens: 400,
                        temperature: 0.7
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    aiDiv.textContent = data.choices[0].message.content;
                } else {
                    aiDiv.textContent = `‚ùå Errore OpenAI: ${data.error?.message || 'Controlla key'}`;
                }
            } catch (error) {
                aiDiv.textContent = '‚ùå Errore connessione. Riprova.';
                console.error('GPT Error:', error);
            }
            chat.scrollTop = chat.scrollHeight;
        }
        
        // INIT ‚úÖ
        updateCityCoords();
        updateMeteo();
        setInterval(updateMeteo, 5 * 60 * 1000);
        setInterval(() => { if(document.getElementById('sismico').style.display !== 'none') updateSismico(); }, 2 * 60 * 1000);
        setInterval(() => { if(document.getElementById('crypto').style.display !== 'none') updateCrypto(); }, 60 * 1000);
    </script>
</body>
</html>

